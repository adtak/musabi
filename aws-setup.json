{
  "trust_policy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Principal": {
          "Federated": "arn:aws:iam::YOUR_ACCOUNT_ID:oidc-provider/token.actions.githubusercontent.com"
        },
        "Action": "sts:AssumeRoleWithWebIdentity",
        "Condition": {
          "StringEquals": {
            "token.actions.githubusercontent.com:aud": "sts.amazonaws.com"
          },
          "StringLike": {
            "token.actions.githubusercontent.com:sub": "repo:adtak/musabi:*"
          }
        }
      }
    ]
  },
  "permission_policy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Action": [
          "ecr:GetAuthorizationToken",
          "ecr:BatchCheckLayerAvailability",
          "ecr:GetDownloadUrlForLayer",
          "ecr:BatchGetImage",
          "ecr:PutImage",
          "ecr:InitiateLayerUpload",
          "ecr:UploadLayerPart",
          "ecr:CompleteLayerUpload"
        ],
        "Resource": "*"
      },
      {
        "Effect": "Allow",
        "Action": [
          "lambda:UpdateFunctionCode",
          "lambda:GetFunction",
          "lambda:PublishVersion"
        ],
        "Resource": [
          "arn:aws:lambda:ap-northeast-1:YOUR_ACCOUNT_ID:function:GenTextLambda",
          "arn:aws:lambda:ap-northeast-1:YOUR_ACCOUNT_ID:function:GenImgLambda",
          "arn:aws:lambda:ap-northeast-1:YOUR_ACCOUNT_ID:function:EditImgLambda",
          "arn:aws:lambda:ap-northeast-1:YOUR_ACCOUNT_ID:function:PubImgLambda"
        ]
      }
    ]
  },
  "aws_cli_commands": {
    "create_oidc_provider": "aws iam create-open-id-connect-provider --url https://token.actions.githubusercontent.com --client-id-list sts.amazonaws.com --thumbprint-list 6938fd4d98bab03faadb97b34396831e3780aea1",
    "create_role": "aws iam create-role --role-name GitHubActionsRole --assume-role-policy-document file://trust-policy.json",
    "attach_policy": "aws iam put-role-policy --role-name GitHubActionsRole --policy-name GitHubActionsPolicy --policy-document file://permission-policy.json"
  },
  "github_secrets": {
    "AWS_ROLE_ARN": "arn:aws:iam::YOUR_ACCOUNT_ID:role/GitHubActionsRole"
  }
}